<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Initial Idiom Test</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      background: #1e1e1e;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.7);
      max-width: 700px;
      width: 100%;
      text-align: center;
    }
    input, button {
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background: #333;
      color: #fff;
      margin-top: 10px;
    }
    input:focus { outline: 2px solid #bb86fc; }
    button:hover { background: #444; }
    .option-btn {
      margin: 10px;
      background: #292929;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
    .option-btn:hover { background: #444; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Initial Test</h1>
    <div id="entry">
      <p>Please enter your name:</p>
      <input type="text" id="userName" placeholder="Your Name" />
      <br />
      <button id="startBtn" disabled>Start Test</button>
    </div>

    <div id="initialTest" style="display:none;">
      <h2>Choose the correct meaning:</h2>
      <div id="initQuestion" style="font-size: 20px; margin-top: 20px;"></div>
      <div id="initOptions" style="margin-top: 20px;"></div>
    </div>

    <div id="thankYou" style="display:none;">
      <h2>Thank you!</h2>
      <p>Your answers have been saved.</p>
    </div>
  </div>

  <script>
    const idioms = [
      { text: "To get off the hook", meaningEn: "To escape from an unpleasant situation" },
      { text: "To fly off the handle", meaningEn: "To lose your temper suddenly" },
      { text: "To lay something at somebodyâ€™s door", meaningEn: "To blame someone for something" },
      { text: "To paint the town red", meaningEn: "To go out and party exuberantly" },
      { text: "To get cold feet", meaningEn: "To suddenly become nervous or afraid to do something" },
      { text: "To hang fire", meaningEn: "To delay making a decision" },
      { text: "To stick to your guns", meaningEn: "To maintain your position firmly" },
      { text: "To have had your fill of something", meaningEn: "To be fed up or tired of something" },
      { text: "To sit on the fence", meaningEn: "To avoid taking sides in a dispute" },
      { text: "To be in for it", meaningEn: "To be about to experience something unpleasant" },
      { text: "To play the field", meaningEn: "To date multiple people without committing" },
      { text: "To show your hand", meaningEn: "To reveal your intentions or plans" },
      { text: "To wear your heart on your sleeve", meaningEn: "To openly show your emotions" },
      { text: "To carry the day", meaningEn: "To win or succeed in a conflict or competition" },
      { text: "To manage to keep a straight face", meaningEn: "To not laugh or show emotion" }
    ];

    let userName = '';
    let initIdx = 0;
    let responses = [];
    let startTime = 0;

    const entry = document.getElementById('entry');
    const startBtn = document.getElementById('startBtn');
    const userNameInput = document.getElementById('userName');
    const initDiv = document.getElementById('initialTest');
    const initQ = document.getElementById('initQuestion');
    const initO = document.getElementById('initOptions');
    const thankYou = document.getElementById('thankYou');

    userNameInput.addEventListener('input', () => {
      startBtn.disabled = userNameInput.value.trim() === '';
    });

    startBtn.addEventListener('click', () => {
      userName = userNameInput.value.trim();
      if (!userName) return;
      entry.style.display = 'none';
      initDiv.style.display = 'block';
      nextInit();
    });

    function getRandomWrong(correctIdx) {
      const pool = idioms.filter((_, i) => i !== correctIdx);
      return pool[Math.floor(Math.random() * pool.length)];
    }

    function nextInit() {
      if (initIdx >= idioms.length) {
        const score = responses.filter(r => r.correct).length;
        const avgTime = responses.reduce((sum, r) => sum + r.time, 0) / responses.length;

        const payload = {
          user: userName,
          score,
          avgTime: avgTime.toFixed(2),
          responses
        };

        // ðŸŸ¢ ArtÄ±k veriyi sunucuya gÃ¶nderiyoruz!
        fetch('https://idiom-backend.onrender.com/submit-initial', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(() => {
          initDiv.style.display = 'none';
          thankYou.style.display = 'block';
        })
        .catch(err => {
          console.error("GÃ¶nderim hatasÄ±:", err);
          alert("SonuÃ§lar gÃ¶nderilemedi. LÃ¼tfen tekrar deneyin.");
        });

        return;
      }

      const cur = idioms[initIdx];
      initQ.textContent = `${initIdx + 1}. ${cur.text}`;
      initO.innerHTML = '';

      const wrong = getRandomWrong(initIdx);
      const opts = [cur.meaningEn, wrong.meaningEn].sort();
      opts.forEach(opt => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.className = 'option-btn';
        btn.onclick = () => {
          responses.push({ correct: opt === cur.meaningEn, time: Date.now() - startTime });
          initIdx++;
          nextInit();
        };
        initO.appendChild(btn);
      });

      startTime = Date.now();
    }
  </script>
</body>
</html>
